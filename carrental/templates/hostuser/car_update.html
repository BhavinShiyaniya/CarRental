{% extends "hostuser_base/hostuser_base.html" %}
{% load static %}

{% block title %}CarRental - Update Car {% endblock title %}

{% block content %}

<main id="main" class="main">
  {% include "messages.html" %}

    <div class="pagetitle">
      <h1>Update Car</h1>
      <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'hostuser:dashboard' %}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{% url 'hostuser:carlist' %}">Car List</a></li>
            <li class="breadcrumb-item"><a href="{% url 'hostuser:hostcardetail' pk=car.id %}">Car Detail</a></li>
            <li class="breadcrumb-item active"><a href="{% url 'hostuser:carupdate' pk=car.id %}">Update Car</a></li>
        </ol>
      </nav>
    </div><!-- End Page Title -->
    <section class="section">
      <div class="row">

        <!-- Dummy Col Start -->
        <div class="col-lg-2"></div>
        <!-- Dummy Col End -->

        <!-- Car Update Col Start -->
        <div class="col-lg-8">

            <div class="card">
                <div class="card-body">
                <h5 class="card-title">Update Car</h5>
    
                <!-- Car Update Form -->
                <form class="row g-3" method="POST" enctype="multipart/form-data" id="carupdateform">
                    {% csrf_token %}

                    <div class="col-md-5">
                        <div class="col-md-12">
                          <div class="form-floating">
                            {{ form.brand }}
                            {% comment %} <input type="text" class="form-control" id="floatingCity" placeholder="Brand"> {% endcomment %}
                            <label for="floatingCity">Brand</label>
                          </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="col-md-12">
                            <div class="form-floating">
                                {{ form.name }}
                              {% comment %} <input type="text" class="form-control" id="floatingName" placeholder="Name"> {% endcomment %}
                              <label for="floatingCity">Name</label>
                            </div>
                          </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-floating">
                            {{ form.manufacture_year }}
                          {% comment %} <input type="text" class="form-control" id="floatingZip" placeholder="Manufacture Year"> {% endcomment %}
                          <label for="floatingZip">Manufacture Year</label>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="col-md-12">
                          <div class="form-floating">
                            {{ form.transmission_type }}
                            {% comment %} <input type="text" class="form-control" id="floatingCity" placeholder="Transmission Type"> {% endcomment %}
                            <label for="floatingCity">Transmission Type</label>
                          </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-floating">
                            {{ form.fuel_type }}
                            {% comment %} <input type="text" class="form-control" id="floatingZip" placeholder="Fuel Type"> {% endcomment %}
                            <label for="floatingZip">Fuel Type</label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-floating">
                            {{ form.car_type }}
                          {% comment %} <input type="text" class="form-control" id="floatingZip" placeholder="Car Type"> {% endcomment %}
                          <label for="floatingZip">Car Type</label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-floating">
                            {{ form.seats }}
                          {% comment %} <input type="text" class="form-control" id="floatingZip" placeholder="Seats"> {% endcomment %}
                          <label for="floatingZip">Seats</label>
                        </div>
                    </div>

                    <div class="col-md-5">
                        <div class="col-md-12">
                          <div class="form-floating">
                            <input type="text" class="form-control" id="floatingCity" value={{ car.registration_no }} placeholder="Registration No" disabled>
                            <label for="floatingCity">Registration No</label>
                            <p class="text-danger">* You can't change your Registration No</p>
                          </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="col-md-12">
                            <div class="form-floating">
                                {{ form.km_driven }}
                              {% comment %} <input type="text" class="form-control" id="floatingName" placeholder="KM Driven"> {% endcomment %}
                              <label for="floatingCity">KM Driven</label>
                            </div>
                          </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-floating">
                            {{ form.fare }}
                          {% comment %} <input type="text" class="form-control" id="floatingZip" placeholder="Fare"> {% endcomment %}
                          <label for="floatingZip">Fare</label>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="form-floating">
                            {{ form.description }}
                          {% comment %} <textarea class="form-control" placeholder="Description" id="floatingTextarea" style="height: 100px;"></textarea> {% endcomment %}
                          <label for="floatingTextarea">Description</label>
                        </div>
                      </div>
                  
                    <div class="col-12">
                      <div class="form-floating">
                        {{ form.pickup_address }}
                        {% comment %} <textarea class="form-control" placeholder="Pickup Address" id="floatingTextarea" style="height: 100px;"></textarea> {% endcomment %}
                        <label for="floatingTextarea">Pickup Address</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="col-md-12">
                        <div class="form-floating">
                            {{ form.pickup_city }}
                          {% comment %} <input type="text" class="form-control" id="floatingCity" placeholder="City"> {% endcomment %}
                          <label for="floatingCity">City</label>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                        <div class="col-md-12">
                          <div class="form-floating">
                            {{ form.pickup_state }}
                            {% comment %} <input type="text" class="form-control" id="floatingCity" placeholder="State"> {% endcomment %}
                            <label for="floatingCity">State</label>
                          </div>
                        </div>
                      </div>
                    <div class="col-md-3">
                        <div class="col-md-12">
                          <div class="form-floating">
                            {{ form.pickup_country }}
                            {% comment %} <input type="text" class="form-control" id="floatingCity" placeholder="Country"> {% endcomment %}
                            <label for="floatingCity">Country</label>
                          </div>
                        </div>
                      </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        {{ form.pickup_pincode }}
                        {% comment %} <input type="text" class="form-control" id="floatingZip" placeholder="Pincode"> {% endcomment %}
                        <label for="floatingZip">Pincode</label>
                      </div>
                    </div>

                    {% comment %} Car Image Field {% endcomment %}

                    {% comment %} {% for formset in inlines %}
                        {{ formset }}
                    {% endfor %}  {% endcomment %}
                   

                    <div class="col-md-12">
                        <div class="form-check form-switch mt-2">
                            {{ form.is_active }}
                            {% comment %} <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" checked=""> {% endcomment %}
                            <label class="form-check-label" for="flexSwitchCheckChecked">is Available for Rent</label>
                        </div>
                    </div>

                    <div class="col-md-12">
                      <label for="inputEmail5" class="form-label">Car Images</label>
                      <input type="file" class="form-control" name="car_images" id="car_images" accept="image/*" multiple>
                      <p class="text-primary">* Select multiple images instead of selecting one for enhanced booking chances!</p>
                    </div>

                  </form><!-- End Car Update Form -->

                  <div class="container row">
                  {% for image in car.car_image_set.all %}
                    <div class="col-md-2 ms-3 text-center overflow-hidden" style="width:154px;margin:5px">
                      <img class="d-block" src="{{ image.car_images.url }}" width=auto height="100px">
                      <form action="{% url 'hostuser:singlecarimagedelete' pk=image.id %}" method="POST">
                        {% csrf_token %}
                      <input type="hidden" value="{{image.id}}" name="image_id" id="image_id" />
                      {% if car.car_image_set.all|length > 1 %}
                      <button type="button" class="btn btn-danger mt-1 confirmdeletebtn"><i class="fa fa-trash"></i></button>
                      {% else %}
                      <p class="text-danger">You can't delete all images from car.</p>
                      {% endif %}
                      </form>
                    </div>
                    {% endfor %}
                  </div>
                  

                  <div class="text-center d-grid gap-2 mt-5">
                    <input type="submit" form="carupdateform" class="btn btn-primary" value="Update" />
                    {% comment %} <button type="reset" class="btn btn-secondary">Reset</button> {% endcomment %}
                  </div>
    
                </div>
              </div>

        </div>
        <!-- Car Update Col End -->

        <!-- Dummy Col Start -->
        <div class="col-lg-2"></div>
        <!-- Dummy Col End -->

      </div>
    </section>

  </main><!-- End #main -->


{% endblock content %}

{% block javascripts %}
<script>
  $('.confirmdeletebtn').click(function(event) {
    var form =  $(this).closest("form");
    var name = $(this).data("name");
    event.preventDefault();
    Swal.fire({
      title: 'Are you sure?',
      text: "You won't be able to revert this!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      if (result.isConfirmed) {
        form.submit();
        Swal.fire(
          'Deleted!',
          'Your file has been deleted.',
          'success'
        )
      }else if (result.dismiss === Swal.DismissReason.cancel) {
        Swal.fire(
          'Cancelled',
          'Your imaginary file is safe :)',
          'error'
        )
      }
    });
  });
</script>

{% endblock javascripts %}

